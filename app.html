<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SKIPPABLE | Track Skips, Not Classes</title>
  <link rel="icon" type="image/png" href="faviconv1.png">
  <link rel="apple-touch-icon" href="faviconv1.png">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      /* Palette */
      --color-black: #0B0B0B;
      --color-charcoal: #1E1E1E;
      --color-yellow: #FFD60A;
      --color-cream: #FFF8E1;
      --color-green: #22C55E;
      --color-amber: #F59E0B;
      --color-red: #EF4444;

      /* Utils */
      --color-text-main: var(--color-cream);
      --color-text-muted: rgba(255, 248, 225, 0.6);
      --color-border: rgba(255, 255, 255, 0.08);

      /* Shadows */
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
      --shadow-glow: 0 0 20px rgba(255, 214, 10, 0.15);

      /* Gradients */
      --gradient-surface: linear-gradient(180deg, rgba(30, 30, 30, 1) 0%, rgba(20, 20, 20, 1) 100%);

      /* Animation */
      --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --ease-smooth: cubic-bezier(0.16, 1, 0.3, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--color-black);
      color: var(--color-text-main);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 700;
      letter-spacing: -0.02em;
      color: #FFFFFF;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 8rem 2rem 2rem;
      min-height: 100vh;
    }

    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 4rem;
      z-index: 1000;
      background: rgba(11, 11, 11, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--color-border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 800;
      font-size: 1.25rem;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .logo-link {
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .logo-link:hover {
      filter: brightness(1.2);
    }

    .logo-link span {
      position: relative;
      color: var(--color-yellow);
    }

    .logo-link span::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: var(--color-yellow);
      transition: width 0.3s ease;
    }

    .logo-link:hover span::after {
      width: 100%;
    }

    .logo-group {
      display: flex;
      flex-direction: column;
      gap: 0;
      margin: 0;
    }

    .main-content {
      display: grid;
      gap: 2rem;
    }

    .section {
      animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
      animation-fill-mode: both;
    }

    .section:nth-child(2) {
      animation-delay: 0.1s;
    }

    .section:nth-child(3) {
      animation-delay: 0.2s;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: #ffffff;
      letter-spacing: -0.01em;
      text-transform: uppercase;
    }

    .section-title span {
      color: var(--color-yellow);
    }

    .header-actions {
      display: flex;
      gap: 0.75rem;
    }

    .btn {
      font-family: inherit;
      font-size: 0.9375rem;
      font-weight: 600;
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s var(--ease-spring);
      letter-spacing: -0.01em;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
    }

    .btn:active {
      transform: scale(0.96);
    }

    .btn-primary {
      background-color: var(--color-yellow);
      color: var(--color-black);
      box-shadow: 0 4px 12px rgba(255, 214, 10, 0.2);
    }

    .btn-primary:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 20px rgba(255, 214, 10, 0.3);
    }

    .btn-secondary {
      background-color: var(--color-yellow);
      color: var(--color-black);
      border: none;
      box-shadow: 0 4px 12px rgba(255, 214, 10, 0.2);
    }

    .btn-secondary:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 20px rgba(255, 214, 10, 0.3);
      filter: brightness(1.1);
    }

    .btn-small {
      padding: 0.625rem 1.25rem;
      font-size: 0.875rem;
    }

    .btn svg {
      width: 18px;
      height: 18px;
    }

    .subjects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 2rem;
    }

    .subject-card {
      background: var(--color-charcoal);
      border: 1px solid var(--color-yellow);
      border-radius: 20px;
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
      transition: all 0.4s var(--ease-smooth);
      animation: fadeInUp 0.6s var(--ease-smooth);
      animation-fill-mode: both;
    }

    .subject-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .subject-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.25rem;
      position: relative;
      z-index: 2;
    }

    .subject-info {
      flex: 1;
    }

    .subject-name {
      font-size: 1.125rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.25rem;
      letter-spacing: -0.01em;
    }

    .subject-stats {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--color-text-muted);
      font-weight: 500;
      display: flex;
      gap: 0.75rem;
    }

    .subject-stats span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      flex-wrap: wrap;
      font-size: 0.75rem;
      color: var(--color-gray-400);
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      color: #fff;
    }

    .stat-val {
      width: 100%;
      display: block;
      font-size: 1.1rem;
      color: #ffffff;
      margin-top: 4px;
    }

    .stat-edit-btn {
      background: none;
      border: none;
      padding: 2px;
      color: var(--color-gray-500);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.6;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 4px;
    }

    .stat-edit-btn:hover {
      opacity: 1;
      color: var(--color-yellow);
      background: rgba(255, 214, 10, 0.1);
    }

    .stat-edit-btn svg {
      width: 14px;
      height: 14px;
    }

    .subject-actions {
      display: flex;
      gap: 0.35rem;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border: 1px solid var(--color-yellow);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s var(--ease-spring);
      color: var(--color-text-muted);
    }

    .icon-btn:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--color-yellow);
      color: var(--color-yellow);
      transform: translateY(-2px);
    }

    .icon-btn svg {
      width: 14px;
      height: 14px;
      stroke: currentColor;
    }

    .attendance-display {
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 2;
    }

    .attendance-ring {
      width: 120px;
      height: 120px;
      margin: 0 auto 1.25rem;
      position: relative;
      /* filter: drop-shadow(0 0 15px rgba(0, 0, 0, 0.2)); */
    }

    .attendance-ring svg {
      transform: rotate(-90deg);
      width: 120px;
      height: 120px;
    }

    .attendance-ring circle {
      fill: none;
      stroke-width: 8;
      transition: stroke-dashoffset 0.8s var(--ease-smooth), stroke 0.3s ease;
      cx: 60;
      cy: 60;
      r: 52;
    }

    .ring-bg {
      stroke: rgba(255, 255, 255, 0.05);
    }

    .ring-progress {
      stroke: var(--status-color, var(--color-yellow));
      stroke-linecap: round;
      /* filter: drop-shadow(0 0 10px var(--status-color)); */
    }

    .attendance-percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.75rem;
      font-weight: 800;
      font-family: 'Inter', sans-serif;
      color: #ffffff;
      letter-spacing: -0.03em;
    }

    .attendance-label {
      font-size: 0.6875rem;
      color: var(--color-text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.525rem 1.125rem;
      border-radius: 99px;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 1.25rem;
      border: 1px solid var(--status-color);
      color: var(--status-color);
      background: rgba(255, 255, 255, 0.03);
    }

    .status-badge svg {
      width: 12px;
      height: 12px;
    }

    /* Calculator Modal Styles */
    .calculator-result {
      text-align: center;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--color-border);
    }

    .calc-percentage {
      font-size: 3rem;
      font-weight: 900;
      font-family: 'JetBrains Mono', monospace;
      color: var(--calc-color, var(--color-text-muted));
      display: block;
      margin-bottom: 0.5rem;
    }

    .calc-message {
      font-size: 0.875rem;
      color: var(--color-text-muted);
    }

    .impact-section {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--color-border);
      border-radius: 16px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .impact-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--color-text-muted);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .impact-title svg {
      width: 14px;
      height: 14px;
      stroke: var(--color-yellow);
    }

    .impact-options {
      display: grid;
      gap: 0.75rem;
    }

    .impact-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.875rem 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }

    .impact-option:hover {
      transform: translateX(2px);
      border-color: var(--impact-color);
      background: rgba(255, 255, 255, 0.03);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    .impact-label {
      font-size: 0.9375rem;
      color: var(--color-gray-300);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .impact-icon {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .impact-icon svg {
      width: 14px;
      height: 14px;
    }

    .impact-value {
      font-size: 1.25rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .skip-budget {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem;
      background: var(--color-yellow);
      border: 1px solid var(--color-yellow);
      border-radius: 16px;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
      color: var(--color-black);
    }

    .skip-budget:hover {
      transform: scale(1.02);
      box-shadow: 0 0 30px rgba(255, 208, 0, 0.2);
    }

    .skip-budget-icon {
      width: 48px;
      height: 48px;
      background: rgba(0, 0, 0, 0.06);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .skip-budget-icon svg {
      width: 24px;
      height: 24px;
      stroke: var(--color-black);
    }

    .skip-budget-text {
      flex: 1;
    }

    .skip-budget-label {
      font-size: 0.65rem;
      color: rgba(0, 0, 0, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 0.15rem;
      font-weight: 800;
    }

    .skip-budget-value {
      font-size: 1.125rem;
      font-weight: 800;
      color: #000000;
    }

    .health-score {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--color-border);
      border-radius: 16px;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .health-score::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--status-color);
      box-shadow: 0 0 10px var(--status-color);
    }

    .health-score-value {
      font-size: 2rem;
      font-weight: 800;
      font-family: 'JetBrains Mono', monospace;
      color: var(--status-color);
      min-width: 60px;
    }

    .health-score-text {
      flex: 1;
    }

    .health-score-label {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .subject-actions-bottom {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .btn-skip {
      background: transparent;
      color: var(--color-text-muted);
      border: 1px solid var(--color-border);
    }

    .btn-skip:hover {
      background: var(--color-charcoal);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .btn-attend {
      background: rgba(255, 214, 10, 0.05);
      color: var(--color-yellow);
      border: 1px solid rgba(255, 214, 10, 0.3);
    }

    .btn-attend:hover {
      background: var(--color-yellow);
      color: var(--color-black);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
      transform: translateY(-2px);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      padding: 1rem;
      animation: fadeIn 0.3s ease;
    }

    .modal {
      background: var(--color-charcoal);
      border: 1px solid var(--color-yellow);
      border-radius: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideUpModal 0.4s var(--ease-spring);
    }

    @keyframes slideUpModal {
      from {
        transform: translateY(40px) scale(0.95);
        opacity: 0;
      }

      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--color-border);
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .modal-title svg {
      width: 24px;
      height: 24px;
      stroke: var(--color-yellow);
    }

    .modal-body {
      padding: 2rem;
    }

    .modal-footer {
      padding: 1.5rem 2rem;
      border-top: 1px solid var(--color-border);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-muted);
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--color-border);
      border-radius: 10px;
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.2s ease;
      background: rgba(0, 0, 0, 0.3);
      color: #ffffff;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-yellow);
      box-shadow: 0 0 0 3px rgba(255, 214, 10, 0.1);
      background: rgba(0, 0, 0, 0.5);
    }

    .recovery-panel {
      background: rgba(255, 214, 10, 0.03);
      border: 1px solid rgba(255, 214, 10, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .recovery-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--color-yellow);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .recovery-title svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
    }

    .recovery-text {
      font-size: 0.9375rem;
      color: var(--color-text-muted);
      margin-bottom: 1rem;
    }

    .progress-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 99px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: #60A5FA;
      transition: width 0.6s var(--ease-spring);
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      background: var(--color-charcoal);
      border: 1px solid var(--color-yellow);
      border-radius: 24px;
    }

    .empty-icon {
      width: 100px;
      height: 100px;
      margin: 0 auto 1.5rem;
      background: rgba(255, 214, 10, 0.05);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .empty-icon svg {
      width: 48px;
      height: 48px;
      stroke: var(--color-yellow);
    }

    .empty-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.5rem;
    }

    .empty-text {
      font-size: 1rem;
      color: var(--color-text-muted);
      margin-bottom: 2rem;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .early-semester-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(255, 214, 10, 0.1);
      border: 1px solid rgba(255, 214, 10, 0.2);
      border-radius: 99px;
      font-size: 0.75rem;
      color: var(--color-yellow);
      margin-bottom: 1.5rem;
      font-weight: 700;
      position: relative;
      z-index: 2;
      animation: bounceIn 0.6s var(--ease-spring);
      margin-right: 1rem;
    }

    .early-semester-badge svg {
      width: 14px;
      height: 14px;
      stroke: var(--color-yellow);
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }

      50% {
        transform: scale(1.1);
        opacity: 1;
      }

      100% {
        transform: scale(1);
      }
    }

    .semester-summary {
      background: var(--color-charcoal);
      border: 1px solid var(--color-border);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: var(--shadow-lg);
    }

    .summary-header {
      text-align: center;
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--color-border);
    }

    .summary-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: #ffffff;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
    }

    .summary-title svg {
      width: 28px;
      height: 28px;
      stroke: var(--color-yellow);
    }

    .summary-subtitle {
      font-size: 0.9375rem;
      color: var(--color-text-muted);
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .summary-stat {
      text-align: center;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--color-border);
      border-radius: 16px;
      transition: all 0.2s ease;
    }

    .summary-stat:hover {
      transform: translateY(-2px);
      border-color: var(--color-yellow);
      background: rgba(255, 255, 255, 0.04);
    }

    .summary-stat-value {
      font-size: 2rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: var(--color-yellow);
      margin-bottom: 0.25rem;
    }

    .summary-stat-label {
      font-size: 0.8125rem;
      color: var(--color-text-muted);
      font-weight: 500;
    }

    .summary-highlights {
      display: grid;
      gap: 1rem;
    }

    .summary-highlight {
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 16px;
      border: 1px solid var(--color-border);
      border-left: 4px solid var(--highlight-color, var(--color-yellow));
      transition: all 0.2s ease;
    }

    .summary-highlight:hover {
      transform: translateX(4px);
      background: rgba(255, 255, 255, 0.04);
    }

    .summary-highlight-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .summary-highlight-title svg {
      width: 16px;
      height: 16px;
      stroke: var(--highlight-color);
    }

    .summary-highlight-text {
      font-size: 0.875rem;
      color: var(--color-text-muted);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--color-charcoal);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 99px;
      box-shadow: var(--shadow-lg);
      animation: slideInRight 0.4s var(--ease-spring);
      z-index: 2000;
      max-width: 400px;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success {
      border-color: var(--color-green);
      color: var(--color-green);
    }

    .toast.warning {
      border-color: var(--color-yellow);
      color: var(--color-yellow);
    }

    .toast.error {
      border-color: var(--color-red);
      color: var(--color-red);
    }

    .toast svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      stroke: currentColor;
    }

    @media (max-width: 1024px) {
      .subjects-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
    }

    /* Responsiveness */
    /* Responsiveness & 20/80 Logic */
    @media (max-width: 768px) {

      html,
      body {
        height: 100%;
        overflow: hidden;
        /* Disable page scroll */
      }

      .app-container {
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .app-header {
        position: relative;
        /* Flex flow, not fixed */
        height: 8vh;
        flex-shrink: 0;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.5rem;
        background: var(--color-black);
        z-index: 1000;
        border-bottom: 1px solid var(--color-border);
      }

      .logo {
        font-size: 1.1rem;
      }

      .header-actions {
        display: none;
      }

      .menu-toggle {
        display: block !important;
      }

      /* Scrollable Content Area (80%) */
      .main-content {
        flex: 1;
        /* Takes remaining space (approx 80%) */
        overflow-y: auto;
        scroll-snap-type: none;
        padding: 1.5rem;
        -webkit-overflow-scrolling: touch;
        position: relative;
        padding-bottom: 4rem;
        /* Extra space at bottom */
      }

      /* Scroll Lock for Main Content when Modal is Open */
      body.no-scroll .main-content {
        overflow: hidden !important;
      }

      .subjects-grid {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        grid-template-columns: 1fr;
        /* Reset grid */
      }

      /* Snapping Cards */
      .subject-card {
        scroll-snap-align: none;
        min-height: 80vh;
        /* Fits within 90vh container comfortably */
        display: flex;
        flex-direction: column;
        margin-bottom: 2rem;
      }

      .subject-actions-bottom {
        margin-top: auto;
        /* Push buttons to bottom */
      }

      /* Empty State Snapping */
      .empty-state {
        scroll-snap-align: center;
        min-height: 80vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .modal {
        margin: 1rem;
        max-height: 85vh;
        width: calc(100% - 2rem);
        /* Center with margin */
      }

      .toast {
        left: 1rem;
        right: 1rem;
        bottom: 1rem;
        border-radius: 16px;
      }

      .summary-stats {
        grid-template-columns: 1fr;
      }
    }



    @media (max-width: 480px) {
      .subject-header {
        /* Default is row, so this keeps name and actions inline */
        align-items: flex-start;
        /* Align name with buttons */
      }

      .subject-actions {
        /* Keep actions compact */
        margin-left: auto;
        /* Push to right */
      }

      .attendance-percentage {
        font-size: 1.5rem;
      }
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--color-black);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--color-charcoal);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--color-yellow);
    }

    /* Sidebar & Overlay */
    body.no-scroll {
      overflow: hidden !important;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--color-yellow);
      cursor: pointer;
      padding: 0.5rem;
      z-index: 1001;
    }

    .menu-toggle svg {
      width: 32px;
      height: 32px;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(4px);
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .sidebar {
      position: fixed;
      top: 0;
      right: -100%;
      width: 300px;
      height: 100vh;
      background: var(--color-charcoal);
      border-left: 1px solid var(--color-border);
      z-index: 1002;
      transition: right 0.4s var(--ease-spring);
      padding: 2.5rem 2rem;
      display: flex;
      flex-direction: column;
      box-shadow: -10px 0 40px rgba(0, 0, 0, 0.6);
    }

    .sidebar.active {
      right: 0;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid rgba(255, 214, 10, 0.1);
    }

    .close-menu {
      background: var(--color-yellow);
      border: none;
      border-radius: 50%;
      color: var(--color-black);
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s var(--ease-spring);
      z-index: 1005;
      box-shadow: 0 4px 15px rgba(255, 214, 10, 0.3);
    }

    .close-menu:hover {
      transform: scale(1.15) rotate(90deg);
      background: #ffffff;
    }

    .close-menu svg {
      width: 20px;
      height: 20px;
      stroke: var(--color-black) !important;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .sidebar-btn {
      font-size: 1.125rem;
      font-weight: 700;
      color: #ffffff;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--color-border);
      width: 100%;
      cursor: pointer;
      padding: 1rem 1.25rem;
      border-radius: 12px;
      margin-bottom: 0.5rem;
    }

    .sidebar-btn:hover {
      background: rgba(255, 214, 10, 0.1);
      color: var(--color-yellow);
      border-color: var(--color-yellow);
      transform: translateX(4px);
    }

    .sidebar-btn svg {
      width: 20px;
      height: 20px;
      pointer-events: none;
      color: var(--color-yellow);
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // SVG Icons
    const Icons = {
      BookOpen: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
        </svg>
      ),
      Plus: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
      ),
      Edit: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
        </svg>
      ),
      Edit3: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <path d="M12 20h9" />
          <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
        </svg>
      ),
      Trash: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polyline points="3 6 5 6 21 6" />
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
        </svg>
      ),
      TrendingUp: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
          <polyline points="17 6 23 6 23 12" />
        </svg>
      ),
      TrendingDown: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polyline points="23 18 13.5 8.5 8.5 13.5 1 6" />
          <polyline points="17 18 23 18 23 12" />
        </svg>
      ),
      Target: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <circle cx="12" cy="12" r="6" />
          <circle cx="12" cy="12" r="2" />
        </svg>
      ),
      Zap: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
        </svg>
      ),
      Award: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="7" />
          <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" />
        </svg>
      ),
      Check: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polyline points="20 6 9 17 4 12" />
        </svg>
      ),
      X: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      ),
      AlertCircle: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
      ),
      BarChart: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <line x1="12" y1="20" x2="12" y2="10" />
          <line x1="18" y1="20" x2="18" y2="4" />
          <line x1="6" y1="20" x2="6" y2="16" />
        </svg>
      ),
      Calendar: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
      ),
      RotateCcw: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polyline points="1 4 1 10 7 10" />
          <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
        </svg>
      ),
      Star: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
        </svg>
      ),
      Activity: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
        </svg>
      ),
      Menu: () => (
        <svg fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      )
    };

    // Storage utility
    const storage = {
      get: (key) => {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : null;
        } catch {
          return null;
        }
      },
      set: (key, value) => {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
          console.error('Storage error:', e);
        }
      }
    };

    // Calculate attendance percentage
    const calculateAttendance = (totalHeld, skipped) => {
      if (totalHeld === 0) return 100;
      return ((totalHeld - skipped) / totalHeld) * 100;
    };

    // Calculate skip budget
    const calculateSkipBudget = (totalHeld, skipped, threshold) => {
      const attended = totalHeld - skipped;
      const maxSkips = Math.floor((attended - (threshold / 100) * totalHeld) / (threshold / 100));
      return Math.max(0, maxSkips);
    };

    // Calculate recovery classes needed
    const calculateRecovery = (totalHeld, skipped, threshold) => {
      const currentAttendance = calculateAttendance(totalHeld, skipped);
      if (currentAttendance >= threshold) return 0;

      let classesNeeded = 0;
      let tempTotal = totalHeld;
      let tempSkipped = skipped;

      while (calculateAttendance(tempTotal, tempSkipped) < threshold) {
        tempTotal++;
        classesNeeded++;
        if (classesNeeded > 100) break;
      }

      return classesNeeded;
    };

    // Calculate health score
    const calculateHealthScore = (totalHeld, skipped, threshold) => {
      const attendance = calculateAttendance(totalHeld, skipped);
      const skipBudget = calculateSkipBudget(totalHeld, skipped, threshold);
      const consistencyScore = totalHeld > 0 ? Math.min(100, (totalHeld - skipped) * 5) : 100;

      const attendanceWeight = 0.5;
      const budgetWeight = 0.3;
      const consistencyWeight = 0.2;

      const normalizedBudget = Math.min(100, skipBudget * 20);

      return Math.round(
        (attendance * attendanceWeight) +
        (normalizedBudget * budgetWeight) +
        (consistencyScore * consistencyWeight)
      );
    };

    // Get status color (Monochrome + Yellow)
    const getStatusColor = (attendance, threshold) => {
      if (attendance >= threshold + 5) return '#ffffff'; // Safe = White
      if (attendance >= threshold) return 'var(--color-yellow)'; // Warning = Yellow
      return 'var(--color-text-muted)'; // Risk = Gray (dimmed)
    };

    // Get status badge (Monochrome + Yellow)
    const getStatusBadge = (attendance, threshold) => {
      if (attendance >= threshold + 5) return {
        text: 'Safe Zone',
        class: 'status-safe'
      };
      if (attendance >= threshold) return {
        text: 'Warning',
        class: 'status-warning'
      };
      return {
        text: 'At Risk',
        class: 'status-danger'
      };
    };

    // Sidebar Component
    const Sidebar = ({ isOpen, onClose, onOpenCalculator, onOpenSummary, onOpenAddSubject, subjects }) => {
      return (
        <>
          <div className={`sidebar-overlay ${isOpen ? 'active' : ''}`} onClick={onClose}></div>
          <aside className={`sidebar ${isOpen ? 'active' : ''}`}>
            <div className="sidebar-header">
              <a href="index.html" className="logo logo-link"><span>Skippable</span></a>
              <button className="close-menu" onClick={onClose} aria-label="Close Menu">
                <Icons.X />
              </button>
            </div>
            <nav className="sidebar-nav">
              {subjects.length > 0 && (
                <button className="sidebar-btn" onClick={() => { onOpenSummary(); onClose(); }}>
                  Summary <Icons.BarChart />
                </button>
              )}
              <button className="sidebar-btn" onClick={() => { onOpenAddSubject(); onClose(); }}>
                Add Subject <Icons.Plus />
              </button>
              <button className="sidebar-btn" onClick={() => { onOpenCalculator(); onClose(); }}>
                Calculator <Icons.Activity />
              </button>
            </nav>
          </aside>
        </>
      );
    };


    // Toast component
    const Toast = ({ message, type, onClose }) => {
      useEffect(() => {
        const timer = setTimeout(onClose, 3000);
        return () => clearTimeout(timer);
      }, [onClose]);

      const icon = type === 'success' ? <Icons.Check /> : type === 'warning' ? <Icons.AlertCircle /> : <Icons.X />;

      return (
        <div className={`toast ${type}`}>
          {icon}
          <span>{message}</span>
        </div>
      );
    };

    // Subject Card component
    const SubjectCard = ({ subject, onSkip, onAttend, onEdit, onEditStats, onDelete, onUndo }) => {
      const attendance = calculateAttendance(subject.totalHeld, subject.skipped);
      const skipBudget = calculateSkipBudget(subject.totalHeld, subject.skipped, subject.threshold);
      const healthScore = calculateHealthScore(subject.totalHeld, subject.skipped, subject.threshold);
      const statusColor = getStatusColor(attendance, subject.threshold);
      const status = getStatusBadge(attendance, subject.threshold);
      const recoveryNeeded = calculateRecovery(subject.totalHeld, subject.skipped, subject.threshold);

      const ifAttend = subject.totalHeld > 0
        ? calculateAttendance(subject.totalHeld + 1, subject.skipped)
        : 100;
      const ifSkip = subject.totalHeld > 0
        ? calculateAttendance(subject.totalHeld + 1, subject.skipped + 1)
        : 0;

      const circumference = 2 * Math.PI * 66;
      const progress = (attendance / 100) * circumference;

      const isEarlySemester = subject.totalHeld < 10;

      return (
        <div className="subject-card" style={{ '--status-color': statusColor }}>
          <div className="subject-header">
            <div className="subject-info">
              <h3 className="subject-name">{subject.name}</h3>
              <div className="subject-stats">
                <span>
                  Attended:
                  <button
                    className="stat-edit-btn"
                    onClick={() => onEditStats(subject, 'attended')}
                    title="Edit Attended Count"
                  >
                    <Icons.Edit3 />
                  </button>
                  <span className="stat-val">{subject.totalHeld - subject.skipped}</span>
                </span>
                <span>
                  Skipped:
                  <button
                    className="stat-edit-btn"
                    onClick={() => onEditStats(subject, 'skipped')}
                    title="Edit Skipped Count"
                  >
                    <Icons.Edit3 />
                  </button>
                  <span className="stat-val">{subject.skipped}</span>
                </span>
              </div>
            </div>
            <div className="subject-actions">
              <button className="icon-btn" onClick={() => onEdit(subject)} title="Edit">
                <Icons.Edit />
              </button>
              <button className="icon-btn" onClick={onDelete} title="Delete">
                <Icons.Trash />
              </button>
            </div>
          </div>

          {isEarlySemester && (
            <div className="early-semester-badge">
              Early Semester - High Impact
            </div>
          )}

          <div className={`status-badge ${status.class}`} style={{ '--status-color': statusColor }}>
            {status.text}
          </div>

          <div className="attendance-display">
            <div className="attendance-ring">
              <svg width="160" height="160">
                <circle
                  className="ring-bg"
                  cx="80"
                  cy="80"
                  r="66"
                />
                <circle
                  className="ring-progress"
                  cx="80"
                  cy="80"
                  r="66"
                  style={{
                    strokeDasharray: circumference,
                    strokeDashoffset: circumference - progress
                  }}
                />
              </svg>
              <div className="attendance-percentage">
                {attendance.toFixed(1)}%
              </div>
            </div>
            <div className="attendance-label">Current Attendance</div>
          </div>

          {subject.totalHeld > 0 && (
            <div className="impact-section">
              <div className="impact-title">
                <Icons.Activity />
                Today's Impact
              </div>
              <div className="impact-options">
                <div className="impact-option" style={{ '--impact-color': 'var(--color-yellow)' }}>
                  <span className="impact-label">
                    <span className="impact-icon" style={{ background: 'rgba(255, 214, 10, 0.1)' }}>
                      <Icons.TrendingUp />
                    </span>
                    Attend
                  </span>
                  <span className="impact-value" style={{ color: 'var(--color-yellow)' }}>
                    {ifAttend.toFixed(1)}%
                  </span>
                </div>
                <div className="impact-option" style={{ '--impact-color': 'var(--color-text-muted)' }}>
                  <span className="impact-label">
                    <span className="impact-icon" style={{ background: 'rgba(255, 255, 255, 0.05)' }}>
                      <Icons.TrendingDown />
                    </span>
                    Skip
                  </span>
                  <span className="impact-value" style={{ color: 'var(--color-text-muted)' }}>
                    {ifSkip.toFixed(1)}%
                  </span>
                </div>
              </div>
            </div>
          )}

          <div className="skip-budget">
            <div className="skip-budget-icon">
              <Icons.Target />
            </div>
            <div className="skip-budget-text">
              <div className="skip-budget-label">Skip Budget</div>
              <div className="skip-budget-value">
                {skipBudget === 0
                  ? 'No skips remaining'
                  : `${skipBudget} class${skipBudget === 1 ? '' : 'es'} remaining`
                }
              </div>
            </div>
          </div>

          <div className="health-score">
            <div className="health-score-value" style={{ color: statusColor }}>
              {healthScore}
            </div>
            <div className="health-score-text">
              <div className="health-score-label">Health Score</div>
            </div>
          </div>

          {recoveryNeeded > 0 && (
            <div className="recovery-panel">
              <div className="recovery-title">
                <Icons.Target />
                Recovery Plan
              </div>
              <div className="recovery-text">
                Attend next {recoveryNeeded} class{recoveryNeeded === 1 ? '' : 'es'} consecutively to recover
              </div>
              <div className="progress-bar">
                <div
                  className="progress-fill"
                  style={{ width: '0%' }}
                />
              </div>
            </div>
          )}

          <div className="subject-actions-bottom">
            <button className="btn btn-small btn-skip" onClick={onSkip}>
              <Icons.X />
              Skip
            </button>
            <button className="btn btn-small btn-attend" onClick={onAttend}>
              <Icons.Check />
              Attend
            </button>
          </div>

          {subject.canUndo && (
            <button
              className="btn btn-secondary btn-small"
              onClick={onUndo}
              style={{ width: '100%', marginTop: '1rem' }}
            >
              <Icons.RotateCcw />
              Undo Last Action
            </button>
          )}
        </div>
      );
    };

    // Add/Edit Subject Modal
    const SubjectModal = ({ subject, onSave, onClose }) => {
      const [formData, setFormData] = useState({
        name: subject?.name || '',
        threshold: subject?.threshold || 75,
        notes: subject?.notes || ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        if (formData.name.trim()) {
          // Ensure threshold is valid, default to 75 if empty
          const finalThreshold = formData.threshold === '' ? 75 : formData.threshold;
          onSave({ ...formData, threshold: finalThreshold });
        }
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <h2 className="modal-title">
                <Icons.BookOpen />
                {subject ? 'Edit Subject' : 'Add New Subject'}
              </h2>
            </div>
            <form onSubmit={handleSubmit}>
              <div className="modal-body">
                <div className="form-group">
                  <label className="form-label">Subject Name</label>
                  <input
                    type="text"
                    className="form-input"
                    value={formData.name}
                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                    placeholder="e.g., Data Structures"
                    autoFocus
                  />
                </div>
                <div className="form-group">
                  <label className="form-label">
                    Attendance Threshold (%)
                  </label>
                  <input
                    type="number"
                    className="form-input"
                    value={formData.threshold}
                    onChange={(e) => setFormData({ ...formData, threshold: e.target.value === '' ? '' : parseInt(e.target.value) })}
                    min="0"
                    max="100"
                  />
                </div>
                <div className="form-group">
                  <label className="form-label">Notes (Optional)</label>
                  <input
                    type="text"
                    className="form-input"
                    value={formData.notes}
                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                    placeholder="e.g., Lab on Fridays"
                  />
                </div>
              </div>
              <div className="modal-footer">
                <button type="button" className="btn btn-secondary" onClick={onClose}>
                  Cancel
                </button>
                <button type="submit" className="btn btn-primary">
                  <Icons.Check />
                  {subject ? 'Save Changes' : 'Add Subject'}
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // Semester Summary Modal
    const SemesterSummary = ({ subjects, onClose }) => {
      const totalClasses = subjects.reduce((sum, s) => sum + s.totalHeld, 0);
      const totalSkipped = subjects.reduce((sum, s) => sum + s.skipped, 0);
      const totalAttended = totalClasses - totalSkipped;
      const overallAttendance = totalClasses > 0 ? (totalAttended / totalClasses) * 100 : 0;

      const closestCall = subjects.reduce((min, s) => {
        const att = calculateAttendance(s.totalHeld, s.skipped);
        const minAtt = calculateAttendance(min.totalHeld, min.skipped);
        return att < minAtt ? s : min;
      }, subjects[0] || {});

      const bestSubject = subjects.reduce((max, s) => {
        const att = calculateAttendance(s.totalHeld, s.skipped);
        const maxAtt = calculateAttendance(max.totalHeld, max.skipped);
        return att > maxAtt ? s : max;
      }, subjects[0] || {});

      const mostImproved = subjects.filter(s => {
        const recovery = calculateRecovery(s.totalHeld, s.skipped, s.threshold);
        return recovery === 0 && calculateAttendance(s.totalHeld, s.skipped) >= s.threshold;
      })[0];

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <div className="semester-summary">
              <div className="summary-header">
                <h2 className="summary-title">
                  <Icons.BarChart />
                  Semester Snapshot
                </h2>
                <p className="summary-subtitle">Your attendance journey at a glance</p>
              </div>

              <div className="summary-stats">
                <div className="summary-stat">
                  <div className="summary-stat-value">{totalAttended}</div>
                  <div className="summary-stat-label">Classes Attended</div>
                </div>
                <div className="summary-stat">
                  <div className="summary-stat-value">{totalSkipped}</div>
                  <div className="summary-stat-label">Classes Skipped</div>
                </div>
                <div className="summary-stat">
                  <div className="summary-stat-value">{overallAttendance.toFixed(1)}%</div>
                  <div className="summary-stat-label">Overall Attendance</div>
                </div>
                <div className="summary-stat">
                  <div className="summary-stat-value">{subjects.length}</div>
                  <div className="summary-stat-label">Subjects Tracked</div>
                </div>
              </div>

              <div className="summary-highlights">
                {closestCall && (
                  <div className="summary-highlight" style={{ '--highlight-color': 'var(--color-red)' }}>
                    <div className="summary-highlight-title">
                      <Icons.AlertCircle />
                      Closest Call
                    </div>
                    <div className="summary-highlight-text">
                      {closestCall.name} - {calculateAttendance(closestCall.totalHeld, closestCall.skipped).toFixed(1)}%
                    </div>
                  </div>
                )}
                {bestSubject && (
                  <div className="summary-highlight" style={{ '--highlight-color': 'var(--color-green)' }}>
                    <div className="summary-highlight-title">
                      <Icons.Award />
                      Best Performance
                    </div>
                    <div className="summary-highlight-text">
                      {bestSubject.name} - {calculateAttendance(bestSubject.totalHeld, bestSubject.skipped).toFixed(1)}%
                    </div>
                  </div>
                )}
                {mostImproved && (
                  <div className="summary-highlight" style={{ '--highlight-color': 'var(--color-blue)' }}>
                    <div className="summary-highlight-title">
                      <Icons.TrendingUp />
                      Successfully Recovered
                    </div>
                    <div className="summary-highlight-text">
                      {mostImproved.name} - Back on track!
                    </div>
                  </div>
                )}
              </div>

              <div className="modal-footer" style={{ justifyContent: 'center' }}>
                <button className="btn btn-primary" onClick={onClose}>
                  <Icons.Check />
                  Close
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Attendance Calculator Component
    const AttendanceCalculator = ({ onClose }) => {
      const [attended, setAttended] = useState('');
      const [skipped, setSkipped] = useState('');
      const [result, setResult] = useState(null);

      useEffect(() => {
        if (attended !== '' && skipped !== '') {
          const total = parseInt(attended) + parseInt(skipped);
          if (total > 0) {
            const percentage = (parseInt(attended) / total) * 100;
            setResult(percentage);
          } else {
            setResult(null);
          }
        } else {
          setResult(null);
        }
      }, [attended, skipped]);

      let color = 'var(--color-text-muted)';
      let message = 'Enter values to see percentage';

      if (result !== null) {
        if (result >= 75) {
          color = 'var(--color-green)';
          message = 'You are doing great!';
        } else if (result >= 60) {
          color = 'var(--color-amber)';
          message = 'Watch out, getting close to threshold.';
        } else {
          color = 'var(--color-red)';
          message = 'Action needed immediately.';
        }
      }

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <h2 className="modal-title">
                <Icons.Activity />
                Quick Calculator
              </h2>
            </div>
            <div className="modal-body">
              <div className="form-group">
                <label className="form-label">Classes Attended</label>
                <input
                  type="number"
                  className="form-input"
                  value={attended}
                  onChange={(e) => setAttended(e.target.value)}
                  placeholder="0"
                  autoFocus
                />
              </div>
              <div className="form-group">
                <label className="form-label">Classes Skipped</label>
                <input
                  type="number"
                  className="form-input"
                  value={skipped}
                  onChange={(e) => setSkipped(e.target.value)}
                  placeholder="0"
                />
              </div>

              <div className="calculator-result">
                <span className="calc-percentage" style={{ '--calc-color': color }}>
                  {result !== null ? `${result.toFixed(1)}%` : '--%'}
                </span>
                <span className="calc-message">{message}</span>
              </div>
            </div>
            <div className="modal-footer">
              <button className="btn btn-secondary" onClick={onClose}>
                Close
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Main App component
    const App = () => {
      const [subjects, setSubjects] = useState([]);
      const [showAddModal, setShowAddModal] = useState(false);
      const [editingSubject, setEditingSubject] = useState(null);
      const [showSummary, setShowSummary] = useState(false);
      const [showCalculator, setShowCalculator] = useState(false);
      const [toast, setToast] = useState(null);
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);
      const [isInitialLoadDone, setIsInitialLoadDone] = useState(false);

      useEffect(() => {
        // Scroll Locking Logic
        if (isSidebarOpen || showAddModal || editingSubject || showSummary || showCalculator) {
          document.body.classList.add('no-scroll');
        } else {
          document.body.classList.remove('no-scroll');
        }
      }, [isSidebarOpen, showAddModal, editingSubject, showSummary, showCalculator]);

      useEffect(() => {
        const stored = storage.get('subjects');
        if (stored) {
          setSubjects(stored);
        }

        // Check for actions in URL
        const params = new URLSearchParams(window.location.search);
        if (params.get('action') === 'calculator') {
          setShowCalculator(true);
        }
        setIsInitialLoadDone(true);
      }, []);

      useEffect(() => {
        if (isInitialLoadDone) {
          storage.set('subjects', subjects);
        }
      }, [subjects, isInitialLoadDone]);

      const showToast = (message, type = 'success') => {
        setToast({ message, type });
      };

      const handleAddSubject = (formData) => {
        const newSubject = {
          id: Date.now(),
          name: formData.name,
          totalHeld: 0,
          skipped: 0,
          threshold: formData.threshold,
          notes: formData.notes,
          canUndo: false,
          lastAction: null
        };
        setSubjects([...subjects, newSubject]);
        setShowAddModal(false);
        showToast(`${formData.name} added successfully`);
      };

      const handleEditSubject = (formData) => {
        setSubjects(subjects.map(s =>
          s.id === editingSubject.id
            ? { ...s, ...formData }
            : s
        ));
        setEditingSubject(null);
        showToast('Subject updated successfully');
      };

      const handleDeleteSubject = (id) => {
        if (confirm('Are you sure you want to delete this subject?')) {
          setSubjects(subjects.filter(s => s.id !== id));
          showToast('Subject deleted', 'warning');
        }
      };

      const handleSkip = (id) => {
        setSubjects(subjects.map(s =>
          s.id === id
            ? {
              ...s,
              totalHeld: s.totalHeld + 1,
              skipped: s.skipped + 1,
              canUndo: true,
              lastAction: 'skip'
            }
            : s
        ));
        showToast('Class marked as skipped', 'warning');
      };

      const handleAttend = (id) => {
        setSubjects(subjects.map(s =>
          s.id === id
            ? {
              ...s,
              totalHeld: s.totalHeld + 1,
              canUndo: true,
              lastAction: 'attend'
            }
            : s
        ));
        showToast('Class marked as attended', 'success');
      };

      const handleUndo = (id) => {
        setSubjects(subjects.map(s => {
          if (s.id === id && s.canUndo) {
            if (s.lastAction === 'skip') {
              return {
                ...s,
                totalHeld: s.totalHeld - 1,
                skipped: s.skipped - 1,
                canUndo: false,
                lastAction: null
              };
            } else if (s.lastAction === 'attend') {
              return {
                ...s,
                totalHeld: s.totalHeld - 1,
                canUndo: false,
                lastAction: null
              };
            }
          }
          return s;
        }));
        showToast('Action undone');
      };

      const handleEditStats = (subject, type) => {
        const currentAttended = subject.totalHeld - subject.skipped;
        const currentSkipped = subject.skipped;

        const newValue = prompt(
          `Enter new number of classes ${type}:`,
          type === 'attended' ? currentAttended : currentSkipped
        );

        if (newValue === null) return; // Cancelled
        const numValue = parseInt(newValue, 10);
        if (isNaN(numValue) || numValue < 0) {
          alert("Please enter a valid non-negative number.");
          return;
        }

        setSubjects(subjects.map(s => {
          if (s.id === subject.id) {
            let newTotalHeld = s.totalHeld;
            let newSkipped = s.skipped;

            if (type === 'attended') {
              newTotalHeld = numValue + s.skipped;
            } else {
              newSkipped = numValue;
              newTotalHeld = (s.totalHeld - s.skipped) + numValue;
            }
            return { ...s, totalHeld: newTotalHeld, skipped: newSkipped };
          }
          return s;
        }));
        showToast('Stats updated successfully', 'success');
      };

      return (
        <div className="app-container">
          <header className="app-header">
            <a href="index.html" className="logo logo-link"><span>Skippable</span></a>
            <div className="header-actions">
              <button
                className="btn btn-secondary btn-small"
                onClick={() => setShowCalculator(true)}
              >
                <Icons.Activity />
                Calculator
              </button>
              {subjects.length > 0 && (
                <button
                  className="btn btn-secondary btn-small"
                  onClick={() => setShowSummary(true)}
                >
                  <Icons.BarChart />
                  Summary
                </button>
              )}
              <button
                className="btn btn-secondary btn-small"
                onClick={() => setShowAddModal(true)}
              >
                <Icons.Plus />
                Add Subject
              </button>
            </div>
            <button className="menu-toggle" onClick={() => setIsSidebarOpen(true)} aria-label="Open Menu">
              <Icons.Menu />
            </button>
          </header>

          <main className="main-content">
            <section className="section">
              {subjects.length === 0 ? (
                <div className="empty-state">
                  <div className="empty-icon">
                    <Icons.BookOpen />
                  </div>
                  <h3 className="empty-title">No subjects yet</h3>
                  <p className="empty-text">
                    Your attendance era starts here. Add a subject to begin.
                  </p>
                  <button
                    className="btn btn-primary"
                    onClick={() => setShowAddModal(true)}
                  >
                    <Icons.Plus />
                    Add Your First Subject
                  </button>
                </div>
              ) : (
                <div className="subjects-grid">
                  {subjects.map(subject => (
                    <SubjectCard
                      key={subject.id}
                      subject={subject}
                      onSkip={() => handleSkip(subject.id)}
                      onAttend={() => handleAttend(subject.id)}
                      onEdit={() => setEditingSubject(subject)}
                      onEditStats={handleEditStats}
                      onDelete={() => handleDeleteSubject(subject.id)}
                      onUndo={() => handleUndo(subject.id)}
                    />
                  ))}
                </div>
              )}
            </section>
          </main>

          {showAddModal && (
            <SubjectModal
              onSave={handleAddSubject}
              onClose={() => setShowAddModal(false)}
            />
          )}

          {editingSubject && (
            <SubjectModal
              subject={editingSubject}
              onSave={handleEditSubject}
              onClose={() => setEditingSubject(null)}
            />
          )}

          {showSummary && subjects.length > 0 && (
            <SemesterSummary
              subjects={subjects}
              onClose={() => setShowSummary(false)}
            />
          )}

          {showCalculator && (
            <AttendanceCalculator
              onClose={() => setShowCalculator(false)}
            />
          )}

          {toast && (
            <Toast
              message={toast.message}
              type={toast.type}
              onClose={() => setToast(null)}
            />
          )}

          <Sidebar
            isOpen={isSidebarOpen}
            onClose={() => setIsSidebarOpen(false)}
            onOpenCalculator={() => setShowCalculator(true)}
            onOpenSummary={() => setShowSummary(true)}
            onOpenAddSubject={() => setShowAddModal(true)}
            subjects={subjects}
          />
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>